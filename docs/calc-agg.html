<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko-KR" xml:lang="ko-KR"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.523">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="이광춘">

<title>챗GPT SQL - 8&nbsp; 새로운 필드와 집계</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./join.html" rel="next">
<link href="./null-hygene.html" rel="prev">
<link href="./images/logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "일치 없음",
    "search-matching-documents-text": "일치된 문서",
    "search-copy-link-title": "검색 링크 복사",
    "search-hide-matches-text": "추가 검색 결과 숨기기",
    "search-more-match-text": "추가 검색결과",
    "search-more-matches-text": "추가 검색결과",
    "search-clear-button-title": "제거",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "취소",
    "search-submit-button-title": "검색",
    "search-label": "검색"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-229551680-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<script defer="" data-domain="r2bit.com/gpt-sql" src="https://plausible.io/js/script.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./select.html">SQL 쿼리</a></li><li class="breadcrumb-item"><a href="./calc-agg.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">새로운 필드와 집계</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="사이드바 전환" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">챗GPT SQL</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/bit2r/gpt-sql/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="리더 모드 전환">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="검색"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">챗GPT SQL</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">시작을 위한 준비</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">들어가며</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">기본 개념</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">실습환경 설정</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">SQL 쿼리</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./select.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">데이터 선택하기</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sort-filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">정렬과 필터</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./null-hygene.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">데이터 결측과 위생</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calc-agg.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">새로운 필드와 집계</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">조인(Join)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./create.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">데이터 생성과 변형</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">데이터베이스 프로그래밍</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">현장활용법</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spreadsheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">엑셀의 역설</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./etl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">데이터베이스 ETL</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./duck_postgreSQL.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">생산성 향상 전략</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./case_dvd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">DVD 대여 데이터베이스</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">챗GPT SQL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="토글 섹션">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text2sql.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">자연어 SQL 쿼리</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./llm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">오픈소스 SQL LLM</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">참고문헌</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">목차</h2>
   
  <ul>
  <li><a href="#합집합" id="toc-합집합" class="nav-link active" data-scroll-target="#합집합"><span class="header-section-number">8.1</span> 합집합</a></li>
  <li><a href="#집계" id="toc-집계" class="nav-link" data-scroll-target="#집계"><span class="header-section-number">8.2</span> 집계</a></li>
  <li><a href="#연습문제" id="toc-연습문제" class="nav-link" data-scroll-target="#연습문제">연습문제</a>
  <ul class="collapse">
  <li><a href="#객관식" id="toc-객관식" class="nav-link" data-scroll-target="#객관식">객관식</a></li>
  <li><a href="#염도-측정치-수정" id="toc-염도-측정치-수정" class="nav-link" data-scroll-target="#염도-측정치-수정">염도 측정치 수정</a></li>
  <li><a href="#통합-측정목록" id="toc-통합-측정목록" class="nav-link" data-scroll-target="#통합-측정목록">통합 측정목록</a></li>
  <li><a href="#주요-사이트-식별자" id="toc-주요-사이트-식별자" class="nav-link" data-scroll-target="#주요-사이트-식별자">주요 사이트 식별자</a></li>
  <li><a href="#온도-측정횟수-세기" id="toc-온도-측정횟수-세기" class="nav-link" data-scroll-target="#온도-측정횟수-세기">온도 측정횟수 세기</a></li>
  <li><a href="#null-포함-평균-계산" id="toc-null-포함-평균-계산" class="nav-link" data-scroll-target="#null-포함-평균-계산">NULL 포함 평균 계산</a></li>
  <li><a href="#쿼리-의미는" id="toc-쿼리-의미는" class="nav-link" data-scroll-target="#쿼리-의미는">쿼리 의미는?</a></li>
  <li><a href="#group_concat-함수-사용" id="toc-group_concat-함수-사용" class="nav-link" data-scroll-target="#group_concat-함수-사용">group_concat 함수 사용</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/bit2r/gpt-sql/edit/main/calc-agg.qmd" class="toc-action"><i class="bi bi-github"></i>편집</a></li><li><a href="https://github.com/bit2r/gpt-sql/issues/new" class="toc-action"><i class="bi empty"></i>이슈 보고</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./select.html">SQL 쿼리</a></li><li class="breadcrumb-item"><a href="./calc-agg.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">새로운 필드와 집계</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">새로운 필드와 집계</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>탐험 기록을 주의 깊게 다시 읽은 후, 탐험대가 보고한 방사선 측정치를 5% 상향 조정해야 할 필요가 있음을 깨달았다. 저장된 데이터를 변경하기보다는, 쿼리의 일부로서 현장에서 계산을 수행할 수 있다.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fl">1.05</span> <span class="op">*</span> reading <span class="kw">FROM</span> Survey <span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'rad'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">1.05 * reading</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">10.311</td>
</tr>
<tr class="even">
<td style="text-align: center;">8.19</td>
</tr>
<tr class="odd">
<td style="text-align: center;">8.8305</td>
</tr>
<tr class="even">
<td style="text-align: center;">7.581</td>
</tr>
<tr class="odd">
<td style="text-align: center;">4.5675</td>
</tr>
<tr class="even">
<td style="text-align: center;">2.2995</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1.533</td>
</tr>
<tr class="even">
<td style="text-align: center;">11.8125</td>
</tr>
</tbody>
</table>
<p>쿼리를 실행하면, 표현식 <code>1.05 * reading</code>이 각 행마다 평가된다. 표현식에는 임의의 필드, 통상 많이 사용되는 연산자, 그리고 다양한 함수를 사용할 수 있다. (정확하게는 어떤 데이터베이스 관리자를 사용되느냐에 따라 의존성을 띄게된다.) 예를 들어, 화씨로 된 온도 측정치를 섭씨로 변환하고 소수점 아래 둘째 자리에서 반올림할 수 있다.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> taken, <span class="fu">round</span>(<span class="dv">5</span> <span class="op">*</span> (reading <span class="op">-</span> <span class="dv">32</span>) <span class="op">/</span> <span class="dv">9</span>, <span class="dv">2</span>) <span class="kw">FROM</span> Survey <span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'temp'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">taken</th>
<th style="text-align: center;">round(5*(reading-32)/9, 2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">734</td>
<td style="text-align: center;">-29.72</td>
</tr>
<tr class="even">
<td style="text-align: center;">735</td>
<td style="text-align: center;">-32.22</td>
</tr>
<tr class="odd">
<td style="text-align: center;">751</td>
<td style="text-align: center;">-28.06</td>
</tr>
<tr class="even">
<td style="text-align: center;">752</td>
<td style="text-align: center;">-26.67</td>
</tr>
</tbody>
</table>
<p>예시에서 볼 수 있듯이, 방정식으로부터 생성된 새 필드를 설명하는 문자열은 매우 길고 복잡해질 수 있다. SQL에서 필드 이름을 바꾸는 것이 허용되는데, 계산된 필드든 데이터베이스 기존 필드든 상관없다. 간결함과 명확성을 위한 것이다. 예를 들어, 쿼리를 다음과 같이 작성할 수 있다:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> taken, <span class="fu">round</span>(<span class="dv">5</span> <span class="op">*</span> (reading <span class="op">-</span> <span class="dv">32</span>) <span class="op">/</span> <span class="dv">9</span>, <span class="dv">2</span>) <span class="kw">as</span> Celsius <span class="kw">FROM</span> Survey <span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'temp'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>다른 필드의 값을 조합할 수도 있다. 예를 들어, 문자열 접합 연산자 (string concatenation operator, <code>||</code>)를 사용한다.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> personal <span class="op">||</span> <span class="st">' '</span> <span class="op">||</span> family <span class="kw">FROM</span> Person;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">personal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">William Dyer</td>
</tr>
<tr class="even">
<td style="text-align: center;">Frank Pabodie</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Anderson Lake</td>
</tr>
<tr class="even">
<td style="text-align: center;">Valentina Roerich</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Frank Danforth</td>
</tr>
</tbody>
</table>
<hr>
<p><code>first</code>와 <code>last</code> 대신에 필드 이름으로 <code>personal</code>과 <code>family</code>를 사용하는 것이 이상해 보일지 모른다. 하지만, 문화적 차이를 다루기 위한 필요한 첫번째 단계다. 예를 들어, 다음 규칙을 고려해보자.</p>
<table class="table">
<colgroup>
<col style="width: 48%">
<col style="width: 26%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">성명 전부(Full Name)</th>
<th style="text-align: center;">알파벳 순서</th>
<th style="text-align: center;">이유</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Liu Xiaobo</td>
<td style="text-align: center;">Liu</td>
<td style="text-align: center;">중국 성이 이름보다 먼저 온다.</td>
</tr>
<tr class="even">
<td style="text-align: center;">Leonardo da Vinci</td>
<td style="text-align: center;">Leonardo</td>
<td style="text-align: center;">“da Vinci” 는 “from Vinci”를 뜻한다.</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Catherine de Medici</td>
<td style="text-align: center;">Medici</td>
<td style="text-align: center;">성(family name)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Jean de La Fontaine</td>
<td style="text-align: center;">La Fontaine</td>
<td style="text-align: center;">성(family name)이 “La Fontaine”이다.</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Juan Ponce de Leon</td>
<td style="text-align: center;">Ponce de Leon</td>
<td style="text-align: center;">전체 성(full family name)이 “Ponce de Leon”이다.</td>
</tr>
<tr class="even">
<td style="text-align: center;">Gabriel Garcia Marquez</td>
<td style="text-align: center;">Garcia Marquez</td>
<td style="text-align: center;">이중으로 된 스페인 성(surnames)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Wernher von Braun</td>
<td style="text-align: center;">von <em>or</em> Braun</td>
<td style="text-align: center;">독일 혹은 미국에 있는냐에 따라 달라짐</td>
</tr>
<tr class="even">
<td style="text-align: center;">Elizabeth Alexandra May Windsor</td>
<td style="text-align: center;">Elizabeth</td>
<td style="text-align: center;">군주가 통치하는 이름에 따라 알파벳순으로 정렬</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Thomas a Beckett</td>
<td style="text-align: center;">Thomas</td>
<td style="text-align: center;">시성된(canonized) 이름에 따라 성인이름 사용</td>
</tr>
</tbody>
</table>
<p>분명하게, 심지어 ’personal’과 ’family’라는 두 부분으로 나누는 것만으로는 충분하지 않다.</p>
<section id="합집합" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="합집합"><span class="header-section-number">8.1</span> 합집합</h2>
<p><code>UNION</code> 연산자는 두 개의 쿼리 결과를 결합한다.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> Person <span class="kw">WHERE</span> <span class="kw">id</span> <span class="op">=</span> <span class="st">'dyer'</span> <span class="kw">UNION</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> Person <span class="kw">WHERE</span> <span class="kw">id</span> <span class="op">=</span> <span class="st">'roe'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">id</th>
<th style="text-align: center;">personal</th>
<th style="text-align: center;">family</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">dyer</td>
<td style="text-align: center;">William</td>
<td style="text-align: center;">Dyer</td>
</tr>
<tr class="even">
<td style="text-align: center;">roe</td>
<td style="text-align: center;">Valentina</td>
<td style="text-align: center;">Roerich</td>
</tr>
</tbody>
</table>
<p><code>UNION ALL</code> 명령은 <code>UNION</code> 연산자와 동일하지만, <code>UNION ALL</code>은 모든 값을 선택한다는 점에서 차이가 있다. 차이점은 <code>UNION ALL</code>이 중복 행을 제거하지 않는다는 것이다. 대신, <code>UNION ALL</code>은 쿼리의 모든 행을 가져와서 하나의 테이블로 결합한다. <code>UNION</code> 명령은 결과 세트에 대해 <code>SELECT DISTINCT</code>를 수행한다. 만약 합병할 모든 레코드가 고유하다면, <code>DISTINCT</code> 단계를 건너뛰므로 더 빠른 결과를 얻기 위해 <code>UNION ALL</code>을 사용한다.</p>
</section>
<section id="집계" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="집계"><span class="header-section-number">8.2</span> 집계</h2>
<p>이제 데이터의 평균과 범위를 계산하고자 한다. <code>Visited</code> 테이블에서 모든 날짜 정보를 어떻게 선택하는지 알고 있다.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> dated <span class="kw">FROM</span> Visited;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">dated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1927-02-08</td>
</tr>
<tr class="even">
<td style="text-align: center;">1927-02-10</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1930-01-07</td>
</tr>
<tr class="even">
<td style="text-align: center;">1930-01-12</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1930-02-26</td>
</tr>
<tr class="even">
<td style="text-align: center;">-null-</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1932-01-14</td>
</tr>
<tr class="even">
<td style="text-align: center;">1932-03-22</td>
</tr>
</tbody>
</table>
<p>하지만 조합하기 위해서는 <code>min</code> 혹은 <code>max</code> 같은 <strong>집계 함수(aggregation function)</strong>를 사용해야만 한다. 각 함수는 입력으로 레코드 집합을 받고 출력으로 단일 레코드를 만든다.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">min</span>(dated) <span class="kw">FROM</span> Visited;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">min(dated)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1927-02-08</td>
</tr>
</tbody>
</table>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sql-aggregation.svg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">max</span>(dated) <span class="kw">FROM</span> Visited;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">max(dated)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1932-03-22</td>
</tr>
</tbody>
</table>
<p><code>min</code>과 <code>max</code>는 SQL에 내장된 단지 두개의 집계 함수다. 다른 함수로 많이 사용되는 <code>avg</code>, <code>count</code>, <code>sum</code>을 들 수 있다.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">avg</span>(reading) <span class="kw">FROM</span> Survey <span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'sal'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">avg(reading)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">7.20333333333333</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">count</span>(reading) <span class="kw">FROM</span> Survey <span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'sal'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">count(reading)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">9</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">sum</span>(reading) <span class="kw">FROM</span> Survey <span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'sal'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">sum(reading)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">64.83</td>
</tr>
</tbody>
</table>
<p>여기서 <code>count(reading)</code>을 사용했다. 테이블에서 <code>quant</code>나 다른 필드를 세는 것도 마찬가지로 쉽게 할 수 있다. 심지어 <code>count(*)</code>를 사용할 수도 있다. 이 함수는 값 자체에 대해서는 관심이 없고, 값이 몇 개 있는지만을 고려하기 때문이다.</p>
<p>SQL에서 한 번에 여러 집계작업을 수행할 수도 있다. 예를 들어, 적절한 염분측정치의 범위를 찾을 수도 있다.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">min</span>(reading), <span class="fu">max</span>(reading) <span class="kw">FROM</span> Survey <span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'sal'</span> <span class="kw">AND</span> reading <span class="op">&lt;=</span> <span class="fl">1.0</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">min(reading)</th>
<th style="text-align: center;">max(reading)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">0.21</td>
</tr>
</tbody>
</table>
<p>출력결과가 놀라움을 줄 수도 있지만, 원 결과값과 집계 결과를 조합할 수도 있다.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> person, <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">FROM</span> Survey <span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'sal'</span> <span class="kw">AND</span> reading <span class="op">&lt;=</span> <span class="fl">1.0</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">person</th>
<th style="text-align: center;">count(*)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">lake</td>
<td style="text-align: center;">7</td>
</tr>
</tbody>
</table>
<p>Lake의 이름이 Roerich나 Dyer 대신 나타나는 이유는 무엇일까? 이는 데이터베이스 관리자가 특정 필드를 집계해야 하지만, 집계 방법에 대한 지시가 없을 때 실제 입력 세트에서 하나의 값을 선택하기 때문이다. 이는 처리된 첫 번째 값일 수도 있고, 마지막 값이나 전혀 다른 어떤 값일 수도 있다.</p>
<p>이 쿼리의 경우, <code>person</code> 필드가 그룹화되지 않았기 때문에, 데이터베이스 관리자는 <code>person</code> 칼럼에 대해 어떤 특정 값을 선택한다. 그 결과로 ’lake’가 출력된 것일 수 있는데, 이는 ’lake’가 데이터베이스에서 처리된 첫 번째 또는 마지막 값일 가능성이 있다. 데이터베이스의 내부 작동 방식에 따라, 이러한 선택은 일관성이 없을 수도 있다.</p>
<p>또 다른 중요한 사실은 집계할 값이 없을 때 — 예를 들어, <code>WHERE</code> 절을 만족하는 행이 없는 경우 — 집계의 결과는 “모른다”로 처리되며, 이는 0이나 다른 임의의 값이 아니라는 점이다.</p>
<p>예를 들어, 특정 조건을 만족하는 행이 하나도 없다면, <code>count()</code> 함수와 같은 집계 함수는 0을 반환하지만, <code>sum()</code>이나 <code>avg()</code>와 같은 다른 집계 함수들은 NULL을 반환할 수 있다. 이는 해당 집계 함수가 적용될 데이터가 전혀 없기 때문에, 그 결과가 “알 수 없는 값”이 됨을 의미한다. 이러한 방식은 데이터의 부재가 잘못된 결과로 이어지는 것을 방지하는 데 도움이 된다.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">person</th>
<th style="text-align: center;">max(reading)</th>
<th style="text-align: center;">sum(reading)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">-null-</td>
<td style="text-align: center;">-null-</td>
<td style="text-align: center;">-null-</td>
</tr>
</tbody>
</table>
<p>집계 함수의 또 다른 중요한 특징은 SQL 나머지 부분과는 매우 유용한 방식으로 일관성이 없다는 것이다. 이러한 동작은 다음과 같은 쿼리를 작성할 수 있게 해준다:</p>
<p>집합 함수의 마지막 중요한 한가지 기능은 매우 유용한 방식으로 나머지 SQL과는 일관되지 않다는 점이다. 두 값을 더할 때 하나가 <code>null</code>이면 결과는 <code>null</code>이 된다. 이를 확장하면, <code>sum</code>을 사용하여 집합의 모든 값을 더하고 그 값들 중 하나라도 <code>null</code>이라면 결과도 <code>null</code>이 되어야 한다. 그러나 집계 함수가 <code>null</code> 값을 무시하고 <code>null</code>이 아닌 값들만 결합하는 것이 훨씬 더 유용하다. 명시적으로 항상 필터해야하는 대신에 이것의 결과 쿼리를 다음과 같이 작성할 수 있게 한다.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">min</span>(dated) <span class="kw">FROM</span> Visited;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">min(dated)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1927-02-08</td>
</tr>
</tbody>
</table>
<p>명시적으로 항상 다음과 같이 필터하는 쿼리를 작성할 필요가 없다.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">min</span>(dated) <span class="kw">FROM</span> Visited <span class="kw">WHERE</span> dated <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">min(dated)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1927-02-08</td>
</tr>
</tbody>
</table>
<p>모든 레코드를 한꺼번에 집계하는 것이 항상 의미 있는 것은 아니다. 예를 들어, 데이터에 체계적인 편향(bias)이 있을 것이라고 의심하고, 일부 과학자들의 방사능 측정값이 다른 사람들보다 높다고 생각한다고 가정해보자. 이런 경우에 다음과 같은 방법은 효과적이지 않다:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> person, <span class="fu">count</span>(reading), <span class="fu">round</span>(<span class="fu">avg</span>(reading), <span class="dv">2</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span>  Survey</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'rad'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">person</th>
<th style="text-align: center;">count(reading)</th>
<th style="text-align: center;">round(avg(reading), 2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">roe</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">6.56</td>
</tr>
</tbody>
</table>
<p>데이터베이스 관리자가 각 과학자별로 별도로 집계하는 대신 임의로 한 과학자의 이름을 선택하기 때문에 이 방법은 효과적이지 않다. 과학자가 단지 다섯 명뿐이므로, 다음 형식의 다섯 개의 쿼리를 작성할 수 있다.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> person, <span class="fu">count</span>(reading), <span class="fu">round</span>(<span class="fu">avg</span>(reading), <span class="dv">2</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span>  Survey</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> quant <span class="op">=</span> <span class="st">'rad'</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">AND</span>   person <span class="op">=</span> <span class="st">'dyer'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">person</th>
<th style="text-align: center;">count(reading)</th>
<th style="text-align: center;">round(avg(reading), 2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">dyer</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">8.81</td>
</tr>
</tbody>
</table>
<p>하지만, 이러한 접근법은 성가시고, 만약 50명 혹은 500명의 과학자를 가진 데이터셋을 분석한다면, 모든 쿼리를 올바르게 작성할 가능성은 작다.</p>
<p>필요한 것은 데이터베이스 관리자에게 각 과학자별로 시간을 별도로 집계하도록 <code>GROUP BY</code> 절을 사용하여 지시하는 것이다.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>   person, <span class="fu">count</span>(reading), <span class="fu">round</span>(<span class="fu">avg</span>(reading), <span class="dv">2</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span>     Survey</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span>    quant <span class="op">=</span> <span class="st">'rad'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> person;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">person</th>
<th style="text-align: center;">count(reading)</th>
<th style="text-align: center;">round(avg(reading), 2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">dyer</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">8.81</td>
</tr>
<tr class="even">
<td style="text-align: center;">lake</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1.82</td>
</tr>
<tr class="odd">
<td style="text-align: center;">pb</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">6.66</td>
</tr>
<tr class="even">
<td style="text-align: center;">roe</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">11.25</td>
</tr>
</tbody>
</table>
<p><code>GROUP BY</code>는 그 이름이 암시하는 것처럼 정확히 다음과 같이 동작한다. 지정된 필드의 같은 값을 가진 모든 레코드를 그룹화하여 집계가 각 배치를 별도로 처리할 수 있도록 한다. 각 배치에 모든 레코드는 <code>person</code>에 대해 동일한 값을 가지기 때문에, 데이터베이스 관리자가 임의의 값을 잡아서 집합된 <code>reading</code> 값과 함께 표시하는 것은 더 이상 문제가 되지 않는다.</p>
<p>우리가 한 번에 여러 기준에 따라 정렬할 수 있는 것처럼, 다중 기준에 따라 그룹화할 수도 있다. 예를 들어, 과학자별 및 측정된 양별로 평균 측정값을 얻기 위해서 <code>GROUP BY</code> 절에 다른 필드를 추가하기만 하면 된다.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>   person, quant, <span class="fu">count</span>(reading), <span class="fu">round</span>(<span class="fu">avg</span>(reading), <span class="dv">2</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span>     Survey</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> person, quant;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">person</th>
<th style="text-align: center;">quant</th>
<th style="text-align: center;">count(reading)</th>
<th style="text-align: center;">round(avg(reading), 2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">-null-</td>
<td style="text-align: center;">sal</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: center;">-null-</td>
<td style="text-align: center;">temp</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-26.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">dyer</td>
<td style="text-align: center;">rad</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">8.81</td>
</tr>
<tr class="even">
<td style="text-align: center;">dyer</td>
<td style="text-align: center;">sal</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.11</td>
</tr>
<tr class="odd">
<td style="text-align: center;">lake</td>
<td style="text-align: center;">rad</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1.82</td>
</tr>
<tr class="even">
<td style="text-align: center;">lake</td>
<td style="text-align: center;">sal</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.11</td>
</tr>
<tr class="odd">
<td style="text-align: center;">lake</td>
<td style="text-align: center;">temp</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-16.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">pb</td>
<td style="text-align: center;">rad</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">6.66</td>
</tr>
<tr class="odd">
<td style="text-align: center;">pb</td>
<td style="text-align: center;">temp</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">-20.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">roe</td>
<td style="text-align: center;">rad</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">11.25</td>
</tr>
<tr class="odd">
<td style="text-align: center;">roe</td>
<td style="text-align: center;">sal</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">32.05</td>
</tr>
</tbody>
</table>
<p><code>quant</code>를 표시되는 필드 목록에 추가한 것에 주목하자. 그렇지 않으면 결과가 큰 의미를 가지지 않을 것이다.</p>
<p>한 단계 더 나아가 측정을 수행한 사람을 알 수 없는 모든 항목을 제거해보자.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span>   person, quant, <span class="fu">count</span>(reading), <span class="fu">round</span>(<span class="fu">avg</span>(reading), <span class="dv">2</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span>     Survey</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span>    person <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> person, quant</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> person, quant;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">person</th>
<th style="text-align: center;">quant</th>
<th style="text-align: center;">count(reading)</th>
<th style="text-align: center;">round(avg(reading), 2)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">dyer</td>
<td style="text-align: center;">rad</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">8.81</td>
</tr>
<tr class="even">
<td style="text-align: center;">dyer</td>
<td style="text-align: center;">sal</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">0.11</td>
</tr>
<tr class="odd">
<td style="text-align: center;">lake</td>
<td style="text-align: center;">rad</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">1.82</td>
</tr>
<tr class="even">
<td style="text-align: center;">lake</td>
<td style="text-align: center;">sal</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.11</td>
</tr>
<tr class="odd">
<td style="text-align: center;">lake</td>
<td style="text-align: center;">temp</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-16.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">pb</td>
<td style="text-align: center;">rad</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">6.66</td>
</tr>
<tr class="odd">
<td style="text-align: center;">pb</td>
<td style="text-align: center;">temp</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">-20.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">roe</td>
<td style="text-align: center;">rad</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">11.25</td>
</tr>
<tr class="odd">
<td style="text-align: center;">roe</td>
<td style="text-align: center;">sal</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">32.05</td>
</tr>
</tbody>
</table>
<p>좀더 면밀하게 살펴보면, 이 쿼리는,</p>
<ol type="1">
<li><p><code>Survey</code>테이블에서 <code>person</code> 필드가 <code>null</code>이 아닌 레코드를 선택한다.</p></li>
<li><p>상기 레코드를 부분집합으로 그룹지어서 각 부분집합의 <code>person</code>과 <code>quant</code>의 값은 같다.</p></li>
<li><p>먼저 <code>person</code>으로 부분집합을 정렬하고나서 <code>quant</code>로 각 하위 그룹내에서도 정렬한다.</p></li>
<li><p>각 부분집합의 레코드 숫자를 세고, 각각 <code>reading</code> 평균을 계산하고, 각각 <code>person</code>과 <code>quant</code> 값을 선택한다. (모두 동등하기 때문에 어느 것인지는 문제가 되지 않는다.)</p></li>
</ol>
</section>
<section id="연습문제" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="연습문제">연습문제</h2>
<section id="객관식" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="객관식">객관식</h3>
<ol type="1">
<li><strong>문제:</strong> SQL에서 새로운 계산된 필드를 만들 때 어떤 키워드를 사용합니까?
<ol type="1">
<li><code>CREATE</code></li>
<li><code>CALCULATE</code></li>
<li><code>AS</code></li>
<li><code>DEFINE</code></li>
</ol></li>
</ol>
<ol start="2" type="1">
<li><strong>문제:</strong> 다음 중 집계 함수(aggregation function)는 무엇입니까?
<ol type="1">
<li><code>JOIN</code></li>
<li><code>GROUP BY</code></li>
<li><code>SUM</code></li>
<li><code>ORDER BY</code></li>
</ol></li>
</ol>
<ol start="3" type="1">
<li><strong>문제:</strong> <code>GROUP BY</code> 절을 사용하는 주된 목적은 무엇입니까?
<ol type="1">
<li>데이터베이스의 보안 강화</li>
<li>레코드 정렬</li>
<li>지정된 열 기준으로 레코드 그룹화</li>
<li>중복 레코드 제거</li>
</ol></li>
</ol>
</section>
<section id="염도-측정치-수정" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="염도-측정치-수정">염도 측정치 수정</h3>
<p>추가로 정보를 살펴본 결과, 발렌티나 로에리히(Valentina Roerich)가 염도를 백분율로 보고했다는 것을 알게 되었다. <code>Survey</code> 테이블에서 모든 염도 측정치를 100으로 나눈 값으로 반환하는 쿼리를 작성하시오.</p>
</section>
<section id="통합-측정목록" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="통합-측정목록">통합 측정목록</h3>
<p><code>UNION</code>을 사용하여 발렌티나 로에리히(Roerich가)의 염도 측정치를 앞선 도전과제에서 설명한 대로 수정하고, 발렌티나 로에리히만의 측정치로 통합된 염도 측정치 목록을 만든다. 출력 결과는 다음과 같아야 한다.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">taken</th>
<th style="text-align: center;">reading</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">619</td>
<td style="text-align: center;">0.13</td>
</tr>
<tr class="even">
<td style="text-align: center;">622</td>
<td style="text-align: center;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: center;">734</td>
<td style="text-align: center;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: center;">751</td>
<td style="text-align: center;">0.1</td>
</tr>
<tr class="odd">
<td style="text-align: center;">752</td>
<td style="text-align: center;">0.09</td>
</tr>
<tr class="even">
<td style="text-align: center;">752</td>
<td style="text-align: center;">0.416</td>
</tr>
<tr class="odd">
<td style="text-align: center;">837</td>
<td style="text-align: center;">0.21</td>
</tr>
<tr class="even">
<td style="text-align: center;">837</td>
<td style="text-align: center;">0.225</td>
</tr>
</tbody>
</table>
</section>
<section id="주요-사이트-식별자" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="주요-사이트-식별자">주요 사이트 식별자</h3>
<p><code>Visited</code> 테이블의 사이트 식별자는 ’-’로 구분된 두 부분으로 이루어져 있다.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> site <span class="kw">FROM</span> Visited;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">site</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">DR-1</td>
</tr>
<tr class="even">
<td style="text-align: center;">DR-3</td>
</tr>
<tr class="odd">
<td style="text-align: center;">MSK-4</td>
</tr>
</tbody>
</table>
<p>일부 주요 사이트 식별자(즉, 문자 코드)는 두 글자 길이이고 일부는 세 글자 길이이다. “문자열 내” 함수인 <code>instr(X, Y)</code>는 문자열 X 내에서 문자열 Y가 처음 나타나는 1-기반 인덱스를 반환하며, X 안에 Y가 존재하지 않으면 0을 반환한다. 부분 문자열 함수 <code>substr(X, I, [L])</code>는 X의 I 인덱스에서 시작하는 부분 문자열을 반환하며, 선택적으로 길이 L을 지정할 수 있다. 이 두 함수를 사용하여 고유한 주요 사이트 식별자 목록을 생성한다. (이 데이터의 경우, 목록은 “DR”과 “MSK”만을 포함해야 한다).</p>
</section>
<section id="온도-측정횟수-세기" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="온도-측정횟수-세기">온도 측정횟수 세기</h3>
<p>프랭크 파보디(Frank Pabodie)가 기록한 온도 측정횟수는 몇 번이며, 그 평균 값은 얼마인가?</p>
</section>
<section id="null-포함-평균-계산" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="null-포함-평균-계산">NULL 포함 평균 계산</h3>
<p>집합 값의 평균은 값들의 합을 값들의 개수로 나눈 것이다. 이는 <code>avg</code> 함수가 1.0, <code>null</code>, 5.0이라는 값들이 주어졌을 때 2.0 또는 3.0을 반환한다는 것을 의미하는가?</p>
</section>
<section id="쿼리-의미는" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="쿼리-의미는">쿼리 의미는?</h3>
<p>각 개별 방사능 측정값과 모든 방사능 측정값의 평균 사이의 차이를 계산하고자 한다. 이를 위해 다음과 같은 쿼리를 작성했다.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">avg</span>(reading) <span class="kw">FROM</span> Survey <span class="kw">WHERE</span> quant<span class="op">=</span><span class="st">'rad'</span>;</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>쿼리가 실제로 어떤 결과를 생성하며, 그 이유는 무엇일까?</p>
</section>
<section id="group_concat-함수-사용" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="group_concat-함수-사용">group_concat 함수 사용</h3>
<p><code>group_concat(field, separator)</code> 함수는 지정된 구분자 문자(또는 구분자가 지정되지 않은 경우 ‘,’)를 사용하여 필드의 모든 값을 연결한다. 이를 사용하여 과학자들의 이름을 한 줄 목록으로 생성하면 출력결과는 다음과 같다.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>William Dyer, Frank Pabodie, Anderson Lake, Valentina Roerich, Frank Danforth</span></code><button title="클립보드 복사" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>쉼표로 구분된 모든 과학자들의 성을 나열하는 쿼리를 작성하세요. 쉼표로 구분된 모든 과학자들의 개인 이름과 성을 나열하는 쿼리를 작성하세요.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "복사완료!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "복사완료!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./null-hygene.html" class="pagination-link  aria-label=" &lt;span="" 결측과="" 위생&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">데이터 결측과 위생</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./join.html" class="pagination-link" aria-label="<span class='chapter-number'>9</span>&nbsp; <span class='chapter-title'>조인(Join)</span>">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">조인(Join)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>챗GPT SQL 책은 소프트웨어 카펜트리 Database and SQL 번역한 것이 포함되어 있습니다.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>순수하게 <a href="https://quarto.org/">쿼토(Quarto)</a>로 제작되었습니다.</p>
</div>
  </div>
</footer>




</body></html>